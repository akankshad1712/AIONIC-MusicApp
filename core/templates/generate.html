{% extends 'baseloggedin.html' %}
{% block title %}AI Music Generator - AIONIC{% endblock %}
{% block content %}

<!-- Glass card container -->
<div class="glass"
  style="padding:40px; max-width:750px; margin:auto; border-radius:25px; backdrop-filter:blur(15px); box-shadow:0 15px 50px rgba(0,0,0,0.1);">
  <h1 style="text-align:center; font-size:32px; color:#4f7cff; margin-bottom:15px;">ðŸ¤– AI Music Generator</h1>
  <p style="text-align:center; color:#555; font-size:16px; margin-bottom:30px;">Create immersive music based on your
    mood or text prompt!</p>

  <form method="POST" style="display:flex; flex-direction:column; gap:15px;">
    {% csrf_token %}
    <label for="prompt" style="font-weight:600; color:#333;">Enter your prompt:</label>
    <input type="text" id="prompt" name="prompt" placeholder="I feel energetic..."
      style="padding:14px; border-radius:12px; border:1px solid #cdd4f1; outline:none; transition:0.3s; font-size:15px;">

    <label for="duration" style="font-weight:600; color:#333;">Duration (seconds):</label>
    <input type="text" id="duration" name="duration_seconds" placeholder="30"
      style="padding:14px; border-radius:12px; border:1px solid #cdd4f1; outline:none; transition:0.3s; font-size:15px;">

    <button type="submit" class="btn"
      style="padding:15px; border-radius:15px; font-size:16px; font-weight:600; background:#4f7cff; color:#fff; cursor:pointer; transition:0.3s;">Generate
      Music</button>
  </form>

  {% if generation %}
  <div
    style="margin-top:30px; text-align:center; background:rgba(255,255,255,0.8); padding:20px; border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.08);">
    <h2 style="color:#4f7cff; margin-bottom:10px;">ðŸŽ¶ Generated Track</h2>
    <p style="color:#333; font-weight:500;"><strong>Prompt:</strong> {{ generation.prompt }}</p>
    <p style="color:#555;"><strong>Mood:</strong> {{ generation.mood }} | <strong>Sentiment:</strong> {{
      generation.sentiment_score|floatformat:2 }}</p>
    <audio controls style="margin-top:15px; width:100%; border-radius:10px; outline:none;">
      <source src="{{ generation.audio_file.url }}" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>
  </div>
  {% endif %}
</div>

<!-- Background particles -->
<canvas id="generator-particles" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2;"></canvas>
<script>
  const canvas = document.getElementById('generator-particles');
  const ctx = canvas.getContext('2d');
  let w = canvas.width = window.innerWidth;
  let h = canvas.height = window.innerHeight;

  // Smooth floating particles
  const particles = [];
  for (let i = 0; i < 150; i++) {
    particles.push({
      x: Math.random() * w,
      y: Math.random() * h,
      r: Math.random() * 2 + 1,
      dx: (Math.random() - 0.5) * 0.6,
      dy: (Math.random() - 0.5) * 0.6
    });
  }

  function drawParticles() {
    ctx.clearRect(0, 0, w, h);
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(79,124,255,0.25)";
      ctx.fill();
      p.x += p.dx;
      p.y += p.dy;
      if (p.x < 0 || p.x > w) p.dx *= -1;
      if (p.y < 0 || p.y > h) p.dy *= -1;
    });
    requestAnimationFrame(drawParticles);
  }
  drawParticles();

  window.addEventListener('resize', () => {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  });
</script>

{% endblock %}