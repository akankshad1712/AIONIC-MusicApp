{% extends 'baseloggedin.html' %}
{% block title %}History - AIONIC{% endblock %}
{% block content %}

<div style="max-width:1100px; margin:auto; padding:30px;">
  <h1 style="text-align:center; margin-bottom:40px; font-weight:700; font-size:32px; color:#4f7cff;">ðŸ“œ My Music History
  </h1>

  {% if generations %}
  <div style="display:grid; grid-template-columns: repeat(auto-fill,minmax(300px,1fr)); gap:25px;">
    {% for gen in generations %}
    <div class="glass history-card" style="padding:25px; position:relative; transition:0.3s;">
      <h3 style="margin-bottom:12px; font-size:20px; color:#1a1a2e;">ðŸŽµ {{ gen.prompt|truncatechars:35 }}</h3>
      <p style="font-weight:500; margin-bottom:6px;"><strong>Mood:</strong> {{ gen.mood }}</p>
      <p style="font-weight:500; margin-bottom:6px;"><strong>Sentiment:</strong> {{ gen.sentiment_score|floatformat:2 }}
      </p>
      <p style="font-weight:500; margin-bottom:12px;"><strong>Duration:</strong> {{ gen.duration_seconds }}s</p>

      {% if gen.audio_file %}
      <audio controls
        style="width:100%; margin-top:15px; border-radius:12px; outline:none; box-shadow:0 4px 15px rgba(79,124,255,0.2);">
        <source src="{{ gen.audio_file.url }}" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="text-align:center; font-size:18px; color:#777; margin-top:60px;">No generated music yet. Start creating some
    tracks! ðŸŽ¶</p>
  {% endif %}
</div>

<!-- Background floating particles -->
<canvas id="history-particles" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2;"></canvas>

<style>
  /* Glass-morphic card effect */
  .history-card {
    background: rgba(255, 255, 255, 0.65);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .history-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(79, 124, 255, 0.25);
  }

  /* Smooth fade-in animation */
  .history-card {
    opacity: 0;
    animation: fadeInUp 0.8s forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive audio styling */
  .history-card audio::-webkit-media-controls-panel {
    border-radius: 12px;
    background: rgba(79, 124, 255, 0.05);
  }
</style>

<script>
  const canvas = document.getElementById('history-particles');
  const ctx = canvas.getContext('2d');
  let w = canvas.width = window.innerWidth;
  let h = canvas.height = window.innerHeight;

  const particles = [];
  for (let i = 0; i < 150; i++) {
    particles.push({
      x: Math.random() * w,
      y: Math.random() * h,
      r: Math.random() * 2 + 1.5,
      dx: (Math.random() - 0.5) * 0.6,
      dy: (Math.random() - 0.5) * 0.6
    });
  }

  function drawParticles() {
    ctx.clearRect(0, 0, w, h);
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(79,124,255,0.2)";
      ctx.fill();
      p.x += p.dx;
      p.y += p.dy;
      if (p.x < 0 || p.x > w) p.dx *= -1;
      if (p.y < 0 || p.y > h) p.dy *= -1;
    });
    requestAnimationFrame(drawParticles);
  }
  drawParticles();

  window.addEventListener('resize', () => {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  });
</script>

{% endblock %}